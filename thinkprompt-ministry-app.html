<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ThinkPrompt - Ministry Library</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#f1f5f9 0%,#e2e8f0 100%);color:#1e293b;line-height:1.6;font-size:16px;min-height:100vh}
.page-wrapper{max-width:1200px;margin:0 auto;padding:0}
.brand-header{background:linear-gradient(135deg,#1c1917,#292524);padding:8px 16px;box-shadow:0 8px 32px rgba(0,0,0,.3);color:#fff;text-align:center;border-radius:16px 16px 0 0;margin-bottom:0}
.new-logo{width:100%;max-width:250px;height:auto;margin:0 auto 8px;display:block}
.container{max-width:900px;margin:0 auto;display:flex;flex-direction:column;gap:0}
.card{background:rgba(255,255,255,.95)!important;backdrop-filter:blur(10px)!important;border-radius:0!important;border:1px solid rgba(255,255,255,.2)!important;border-top:none!important;overflow:hidden!important;box-shadow:0 8px 32px rgba(0,0,0,.1)!important;margin:0!important}
.card:last-child{border-bottom:1px solid rgba(255,255,255,.2)!important;border-radius:0 0 16px 16px!important}
.copy-success{position:fixed;top:100px;right:20px;background:#f59e0b;color:#fff;padding:12px 20px;border-radius:8px;font-weight:600;z-index:2000;transform:translateX(100%);transition:transform .3s ease;display:flex;align-items:center;gap:8px}
.copy-success.show{transform:translateX(0)}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:2000}
.modal-dialog{background:#fff;border-radius:16px;max-width:400px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 50px rgba(0,0,0,.3)}
.subsection{border-bottom:1px solid #374151}
.subsection-header{background:linear-gradient(135deg,#1c1917,#292524);padding:16px 28px;border-bottom:1px solid #44403c}
.subsection-title{color:#f59e0b;font-family:Impact,'Arial Black',sans-serif;font-size:18px;font-weight:900;letter-spacing:1px;margin:0 0 6px 0;text-align:center}
.subsection-description{color:#d6d3d1;font-size:13px;font-weight:500;margin:0;opacity:.9}
.starter-tabs-container{background:linear-gradient(135deg,#1c1917,#292524);padding:20px 24px;border-bottom:1px solid #44403c;position:relative}
.starter-tabs-container::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#f59e0b,transparent)}
.starter-tabs-container::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#f59e0b,transparent)}
.starter-tabs{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:12px;max-width:900px;margin:0 auto}
.starter-tab{padding:14px 18px;border:2px solid #44403c;border-radius:10px;background:linear-gradient(135deg,#292524,#3a3632);color:#f59e0b;font-size:13px;font-weight:700;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:6px;min-height:50px;text-align:center;position:relative;overflow:hidden;box-shadow:0 3px 12px rgba(0,0,0,.3)}
.starter-tab:hover{border-color:#f59e0b;color:#fbbf24;background:linear-gradient(135deg,#3a3632,#4a443f);transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,158,11,.3)}
.starter-tab.active{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;border-color:#f59e0b;box-shadow:0 4px 16px rgba(245,158,11,.3);transform:translateY(-2px)}
.templates-header{background:linear-gradient(135deg,#000,#1a1a1a)!important;padding:20px 28px;border-top:1px solid #374151;text-align:center;position:relative}
.templates-header::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,#f59e0b,transparent)}
.templates-title{color:#fff!important;font-family:Impact,'Arial Black',sans-serif;font-size:18px;font-weight:900;letter-spacing:1px;text-shadow:2px 2px 6px rgba(0,0,0,.7);margin:0}
.form-textarea{width:100%;padding:16px 18px;border:2px solid #e2e8f0;border-radius:10px;font-size:16px;resize:vertical;transition:all .3s ease;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);font-family:inherit}
.form-textarea.form-select{min-height:60px;resize:none;appearance:none;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position:right 18px center;background-repeat:no-repeat;background-size:20px;padding-right:50px}
.form-textarea:focus{outline:none;border-color:#dc2626;box-shadow:0 0 0 3px rgba(220,38,38,.1);background:rgba(255,255,255,.98)}
.welcome-state{padding:60px 24px;text-align:center;color:#64748b}
.welcome-icon{font-size:48px;margin-bottom:20px;opacity:.6}
.welcome-title{font-size:20px;font-weight:700;margin-bottom:8px;color:#374151}
.welcome-text{font-size:14px;line-height:1.5}
.workspace-section{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:0 0 16px 16px;border:1px solid rgba(255,255,255,.2);border-top:none;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.1);margin-top:0;display:none}
.workspace-section.show{display:block}
.workspace-title-container{background:linear-gradient(135deg,#1c1917,#292524);padding:20px 28px;text-align:center;position:relative;border-bottom:1px solid #44403c}
.workspace-title-container::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#f59e0b,transparent)}
.workspace-title{color:#f59e0b;font-family:Impact,'Arial Black',sans-serif;font-size:18px;font-weight:900;letter-spacing:1px;text-shadow:2px 2px 6px rgba(0,0,0,.5);margin:0}
.workspace-description{color:#94a3b8;font-size:14px;font-weight:500;margin-top:8px;opacity:.9}
.workspace-actions-container{background:linear-gradient(135deg,#1c1917,#292524);padding:24px;border-bottom:1px solid #44403c;position:relative}
.workspace-actions-container::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#f59e0b,transparent)}
.workspace-actions-container::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#f59e0b,transparent)}
.workspace-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;max-width:900px;margin:0 auto}
.action-btn{padding:14px 18px;border:2px solid #44403c;border-radius:10px;background:linear-gradient(135deg,#292524,#3a3632);color:#f59e0b;font-size:13px;font-weight:700;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:6px;min-height:50px;text-align:center;position:relative;overflow:hidden;box-shadow:0 3px 12px rgba(0,0,0,.3)}
.action-btn:hover{border-color:#f59e0b;color:#fbbf24;background:linear-gradient(135deg,#3a3632,#4a443f);transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,158,11,.2)}
.action-btn.primary{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;border-color:#f59e0b;box-shadow:0 6px 20px rgba(245,158,11,.4);transform:translateY(-2px)}
.workspace-content{padding:32px 28px;min-height:200px}
.prompt-display{width:100%;min-height:300px;padding:20px;border:2px solid #e2e8f0;border-radius:12px;font-size:16px;line-height:1.6;color:#1e293b;background:rgba(255,255,255,.8);backdrop-filter:blur(10px);resize:vertical;white-space:pre-wrap;overflow-y:auto}
.prompt-display:focus{outline:none;border-color:#dc2626;box-shadow:0 0 0 3px rgba(220,38,38,.1);background:rgba(255,255,255,.95)}
.workspace-empty{text-align:center;padding:60px 24px;color:#64748b}
.workspace-empty-icon{font-size:48px;margin-bottom:20px;opacity:.6}
.workspace-empty-title{font-size:20px;font-weight:700;margin-bottom:8px;color:#374151}
.workspace-empty-text{font-size:14px;line-height:1.5}
.starter-prompt-card{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px;cursor:pointer;transition:all .2s}
.starter-prompt-card:hover{border-color:#f59e0b;box-shadow:0 4px 12px rgba(245,158,11,.1);transform:translateY(-1px)}
.icon{width:18px;height:18px;stroke:currentColor;fill:none;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round}
#libraryList{min-height:200px;overflow-y:auto}
.prompt-item{display:flex;align-items:center;padding:12px;border:1px solid #e2e8f0;border-radius:8px;margin-bottom:8px;background:#fff;cursor:pointer;transition:all .2s}
.prompt-item:hover{border-color:#f59e0b;box-shadow:0 2px 8px rgba(245,158,11,.1)}
.prompt-checkbox{margin-right:12px}
.prompt-info{flex:1;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background-color .2s}
.prompt-info:hover{background-color:rgba(245,158,11,.05)}
.prompt-title{font-weight:600;color:#1e293b}
.prompt-date{font-size:12px;color:#64748b;margin-top:4px}
</style>
</head>
<body>
<div class="page-wrapper">
  <div class="copy-success" id="copySuccess">
    <svg class="icon" viewBox="0 0 24 24"><polyline points="20,6 9,17 4,12"></polyline></svg>
    Copied!
  </div>

  <header class="brand-header">
    <svg class="new-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 240">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/>
        </linearGradient>
        <filter id="s"><feDropShadow dx="2" dy="2" stdDeviation="4" flood-color="#000" flood-opacity=".5"/></filter>
      </defs>
      <g transform="translate(20,20)scale(1.08)" stroke="#f59e0b" stroke-width="6" fill="none">
        <path d="M64 16C44 16,28 32,28 52c0 14,9 26,20 32v10h32v-10c11-6,20-18,20-32C100 32,84 16,64 16Z"/>
        <path d="M64 56l-10 12M64 56l10 12M64 56v16"/><line x1="46" y1="100" x2="82" y2="100"/>
        <line x1="48" y1="112" x2="80" y2="112"/><line x1="52" y1="124" x2="76" y2="124"/>
      </g>
      <text x="160" y="100" font-family="Impact" font-size="88" font-weight="900" fill="url(#g)" filter="url(#s)">ThinkPrompt</text>
      <text x="160" y="180" font-family="Impact" font-size="88" font-weight="900" fill="url(#g)" filter="url(#s)">MINISTRY LIBRARY</text>
    </svg>
  </header>

  <div class="container">
    <section class="card">
      <div class="subsection">
        <div class="subsection-header">
          <h3 class="subsection-title">BROWSE LIBRARY BY CATEGORIES</h3>
          <p class="subsection-description" style="font-family: 'Segoe UI', Arial, sans-serif; font-size: 15px; font-weight: 700; opacity: 1;">Choose a category to explore ministry-focused prompts</p>
        </div>
        <div class="starter-tabs-container">
          <div class="starter-tabs" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); max-width: 1000px;">
            <button class="starter-tab" data-category="favorites">
              <svg class="icon" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              Favorites
            </button>
            <button class="starter-tab" data-category="sermon">
              <svg class="icon" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
              Sermon Preparation
            </button>
            <button class="starter-tab" data-category="communications">
              <svg class="icon" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
              Church Communications
            </button>
            <button class="starter-tab" data-category="pastoral">
              <svg class="icon" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
              Pastoral Care
            </button>
            <button class="starter-tab" data-category="operations">
              <svg class="icon" viewBox="0 0 24 24"><path d="M2 20h20"></path><path d="M5 20V9l5-5 5 5v11"></path><path d="M9 9v11"></path><path d="M15 9v11"></path></svg>
              Ministry Operations
            </button>
            <button class="starter-tab" data-category="digital">
              <svg class="icon" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
              Digital Outreach
            </button>
          </div>
        </div>
      </div>
    </section>

    <section class="card" id="librarySection" style="display:none">
      <div class="workspace-title-container">
        <h2 class="workspace-title">LIBRARY</h2>
        <button onclick="document.getElementById('librarySection').style.display='none'" style="position:absolute;top:20px;right:20px;background:none;border:none;color:#f59e0b;font-size:24px;cursor:pointer;opacity:0.8">&times;</button>
      </div>
      <div class="workspace-actions-container">
        <div class="workspace-actions">
          <button class="action-btn primary" onclick="loadPromptPack()">
            <svg class="icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17,10 12,15 7,10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
            Load Prompt Pack
          </button>
          <button class="action-btn primary" onclick="backupLibrary()">
            <svg class="icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
            Backup Library
          </button>
          <button class="action-btn primary" onclick="addSinglePrompt()">
            <svg class="icon" viewBox="0 0 24 24" style="width:24px;height:24px;stroke-width:3"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            Add Prompt
          </button>
        </div>
      </div>
      <div style="display:grid; grid-template-columns:35% 65%; min-height:600px; border-top:1px solid #e2e8f0;">
        <div style="padding:24px; border-right:1px solid #e2e8f0; display:flex; flex-direction:column; overflow:hidden;">
          <input type="text" class="form-textarea" id="librarySearch" placeholder="Search..." style="margin-bottom:16px; min-height:50px; flex-shrink:0;"/>
          <button class="action-btn" id="deleteSelected" style="background:#ef4444;border-color:#ef4444;color:#fff;margin-bottom:20px; flex-shrink:0;">
            <svg class="icon" viewBox="0 0 24 24" style="color:#fff"><polyline points="3,6 5,6 21,6"></polyline><path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>
            Delete Selected
          </button>
          <div id="libraryList" style="overflow-y:auto; flex:1;"></div>
        </div>
        <div style="padding:24px; display:flex; flex-direction:column; overflow:hidden;">
          <div style="display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap; flex-shrink:0;">
            <button class="action-btn" onclick="copyPrompt()" style="flex:1; min-width:100px;">
              <svg class="icon" viewBox="0 0 24 24"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="m4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
              Copy
            </button>
            <button class="action-btn" onclick="editPrompt()" style="flex:1; min-width:100px;">
              <svg class="icon" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
              Edit
            </button>
            <button class="action-btn" onclick="exportPrompt()" style="flex:1; min-width:100px;">
              <svg class="icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
              Export
            </button>
            <button class="action-btn" onclick="saveCurrentPrompt()" style="flex:1; min-width:100px;">
              <svg class="icon" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg>
              Save
            </button>
          </div>
          <div class="prompt-display" id="promptDisplay" contenteditable="true" style="flex:1; overflow-y:auto;">
            <div class="workspace-empty">
              <div class="workspace-empty-icon">ðŸ’­</div>
              <h3 class="workspace-empty-title">No Prompt Selected</h3>
              <p class="workspace-empty-text">Click any prompt to view and edit it here.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<div class="modal-overlay" id="addPromptOverlay" style="display:none">
  <div class="modal-dialog">
    <div class="workspace-title-container">
      <h2 class="workspace-title">ADD NEW PROMPT</h2>
      <button onclick="closeAddPromptModal()" style="position:absolute;top:20px;right:20px;background:none;border:none;color:#f59e0b;font-size:24px;cursor:pointer;opacity:0.8">&times;</button>
    </div>
    <div style="padding:32px">
      <div style="margin-bottom:16px">
        <label style="display:block;font-weight:600;margin-bottom:8px">Title *</label>
        <input type="text" id="newPromptTitle" placeholder="Title..." class="form-textarea" style="min-height:60px;resize:none">
      </div>
      <div style="margin-bottom:16px">
        <label style="display:block;font-weight:600;margin-bottom:8px">Category *</label>
        <select id="newPromptCategory" class="form-textarea form-select">
          <option value="">Choose...</option>
          <option value="sermon">Sermon Preparation</option>
          <option value="communications">Church Communications</option>
          <option value="pastoral">Pastoral Care</option>
          <option value="operations">Ministry Operations</option>
          <option value="digital">Digital Outreach</option>
        </select>
      </div>
      <div style="margin-bottom:24px">
        <label style="display:block;font-weight:600;margin-bottom:8px">Content *</label>
        <textarea id="newPromptContent" placeholder="Paste prompt..." class="form-textarea" style="height:200px"></textarea>
      </div>
      <div style="display:flex;gap:12px;justify-content:flex-end">
        <button onclick="closeAddPromptModal()" style="padding:12px 24px;border:1px solid #d1d5db;background:#fff;color:#374151;border-radius:8px;cursor:pointer">Cancel</button>
        <button onclick="saveNewPrompt()" class="action-btn primary" style="padding:12px 24px;border-radius:8px">Add</button>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="saveModalOverlay" style="display:none">
  <div class="modal-dialog">
    <div class="workspace-title-container">
      <h2 class="workspace-title">Save Prompt</h2>
      <button onclick="closeSaveModal()" style="position:absolute;top:20px;right:20px;background:none;border:none;color:#f59e0b;font-size:24px;cursor:pointer;opacity:0.8">&times;</button>
    </div>
    <div style="padding:32px">
      <div style="margin-bottom:16px">
        <label style="display:block;font-weight:600;margin-bottom:8px">Title *</label>
        <input type="text" id="saveTitle" placeholder="Title..." class="form-textarea" style="min-height:60px;resize:none">
      </div>
      <div style="margin-bottom:24px">
        <label style="display:block;font-weight:600;margin-bottom:8px">Description</label>
        <textarea id="saveDescription" placeholder="Optional..." class="form-textarea" style="height:80px"></textarea>
      </div>
      <div style="display:flex;gap:12px;justify-content:flex-end">
        <button onclick="closeSaveModal()" style="padding:12px 24px;border:1px solid #d1d5db;background:#fff;color:#374151;border-radius:8px;cursor:pointer">Cancel</button>
        <button onclick="confirmSave()" class="action-btn primary" style="padding:12px 24px;border-radius:8px">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="exportModalOverlay" style="display:none">
  <div class="modal-dialog">
    <div class="workspace-title-container">
      <h2 class="workspace-title">Export Prompt</h2>
      <button onclick="closeExportModal()" style="position:absolute;top:20px;right:20px;background:none;border:none;color:#f59e0b;font-size:24px;cursor:pointer;opacity:0.8">&times;</button>
    </div>
    <div style="padding:32px">
      <div style="margin-bottom:24px">
        <label style="display:block;font-weight:600;margin-bottom:8px">Filename *</label>
        <input type="text" id="exportFilename" placeholder="my-prompt" class="form-textarea" style="min-height:60px;resize:none">
        <p style="font-size:12px;color:#64748b;margin-top:8px">.txt will be added automatically</p>
      </div>
      <div style="display:flex;gap:12px;justify-content:flex-end">
        <button onclick="closeExportModal()" style="padding:12px 24px;border:1px solid #d1d5db;background:#fff;color:#374151;border-radius:8px;cursor:pointer">Cancel</button>
        <button onclick="confirmExport()" class="action-btn primary" style="padding:12px 24px;border-radius:8px">Export</button>
      </div>
    </div>
  </div>
</div>

<script>
const PROMPTS={};

function toggleFavorite(id){
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
const prompt=savedPrompts.find(p=>p.id==id);
if(!prompt)return;
prompt.favorite=!prompt.favorite;
localStorage.setItem('thinkprompt_ministry_saved',JSON.stringify(savedPrompts));
const searchTerm=document.getElementById('librarySearch').value;
const activeTab=document.querySelector('.starter-tab.active');
const currentCategory=activeTab?activeTab.dataset.category:'';
renderPromptsList(searchTerm,currentCategory);
}

function initializeFavorites(){
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
let updated=false;
savedPrompts.forEach(prompt=>{
if(prompt.favorite===undefined){
prompt.favorite=false;
updated=true;
}
});
if(updated){
localStorage.setItem('thinkprompt_ministry_saved',JSON.stringify(savedPrompts));
}
}

function loadSystemPrompts(){
const existing=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
const userPrompts=existing.filter(p=>!p.isSystemPrompt);
const systemPrompts=[];
const baseTime=Date.now();
let id=baseTime+1;
Object.keys(PROMPTS).forEach(cat=>{
PROMPTS[cat].forEach(p=>{
systemPrompts.push({id:id++,title:p.t,category:cat,isSystemPrompt:true,content:p.c,favorite:false,created:new Date().toLocaleDateString(),timestamp:new Date().toISOString(),author:'ThinkPrompt Ministry Team'});
});
});
localStorage.setItem('thinkprompt_ministry_saved',JSON.stringify([...systemPrompts,...userPrompts]));
}

function showCopySuccess(msg){
const el=document.getElementById('copySuccess');
el.textContent=msg;
el.classList.add('show');
setTimeout(()=>el.classList.remove('show'),2000);
}

function saveCurrentPrompt(){
const text=(document.getElementById('promptDisplay').textContent||'').trim();
if(!text){alert('No prompt to save.');return;}
document.getElementById('saveModalOverlay').style.display='flex';
document.getElementById('saveTitle').focus();
}

function closeSaveModal(){
document.getElementById('saveModalOverlay').style.display='none';
document.getElementById('saveTitle').value='';
document.getElementById('saveDescription').value='';
}

function confirmSave(){
const title=document.getElementById('saveTitle').value.trim();
if(!title){alert('Please enter a title.');return;}
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
if(savedPrompts.some(p=>p.title.toLowerCase()===title.toLowerCase())){
alert('Title already exists.');
return;
}
const text=document.getElementById('promptDisplay').textContent.trim();
savedPrompts.push({id:Date.now(),title,description:document.getElementById('saveDescription').value.trim(),content:text,favorite:false,created:new Date().toLocaleDateString(),timestamp:new Date().toISOString()});
localStorage.setItem('thinkprompt_ministry_saved',JSON.stringify(savedPrompts));
closeSaveModal();
showCopySuccess('Saved!');
}

function addSinglePrompt(){
document.getElementById('newPromptTitle').value='';
document.getElementById('newPromptCategory').value='';
document.getElementById('newPromptContent').value='';
document.getElementById('addPromptOverlay').style.display='flex';
}

function closeAddPromptModal(){
document.getElementById('addPromptOverlay').style.display='none';
}

function backupLibrary(){
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
if(savedPrompts.length===0){
alert('No prompts to backup.');
return;
}
const backup=JSON.stringify(savedPrompts,null,2);
const blob=new Blob([backup],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=`thinkprompt-ministry-backup-${new Date().toISOString().split('T')[0]}.json`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
showCopySuccess('Library backed up!');
}

function loadPromptPack(){
const input=document.createElement('input');
input.type='file';
input.accept='.json,application/json';
input.onchange=e=>{
const file=e.target.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=event=>{
try{
const imported=JSON.parse(event.target.result);
if(!Array.isArray(imported)){
alert('Invalid prompt pack format.');
return;
}
const existing=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
const combined=[...existing,...imported];
localStorage.setItem('thinkprompt_ministry_saved',JSON.stringify(combined));
showCopySuccess(`Loaded ${imported.length} prompts!`);
}catch(err){
alert('Error loading prompt pack: '+err.message);
}
};
reader.readAsText(file);
};
input.click();
}

function saveNewPrompt(){
const title=document.getElementById('newPromptTitle').value.trim();
const category=document.getElementById('newPromptCategory').value;
const content=document.getElementById('newPromptContent').value.trim();
if(!title||!category||!content){alert('All fields required.');return;}
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
if(savedPrompts.some(p=>p.title.toLowerCase()===title.toLowerCase())){alert('Title exists.');return;}
savedPrompts.push({id:Date.now(),title,category,content,favorite:false,created:new Date().toLocaleDateString(),timestamp:new Date().toISOString(),author:'You'});
localStorage.setItem('thinkprompt_ministry_saved',JSON.stringify(savedPrompts));
closeAddPromptModal();
showCopySuccess('Added!');
}

function showLibrary(categoryFilter=''){
const categoryNames={
'sermon':'Sermon Preparation',
'communications':'Church Communications',
'pastoral':'Pastoral Care',
'operations':'Ministry Operations',
'digital':'Digital Outreach',
'favorites':'Favorites'
};
const titleText=categoryFilter?`LIBRARY - ${categoryNames[categoryFilter]}`:'LIBRARY';
document.querySelector('#librarySection .workspace-title').textContent=titleText;
document.getElementById('librarySection').style.display='block';
renderPromptsList('',categoryFilter);
setTimeout(()=>document.getElementById('librarySection').scrollIntoView({behavior:'smooth'}),100);
}

function renderPromptsList(searchTerm='',categoryFilter=''){
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
const list=document.getElementById('libraryList');
if(savedPrompts.length===0){
list.innerHTML='<div style="text-align:center;padding:40px;color:#64748b"><div style="font-size:48px">ðŸ“‚</div><h3>No prompts yet</h3></div>';
return;
}
let filtered=savedPrompts.filter(p=>p.title.toLowerCase().includes(searchTerm.toLowerCase())||p.content.toLowerCase().includes(searchTerm.toLowerCase()));
if(categoryFilter==='favorites'){
filtered=filtered.filter(p=>p.favorite===true);
}else if(categoryFilter){
filtered=filtered.filter(p=>p.category===categoryFilter);
}
if(filtered.length===0){
list.innerHTML='<div style="text-align:center;padding:40px;color:#64748b"><h3>No prompts in this category</h3></div>';
return;
}
list.innerHTML=filtered.map(p=>`
<div class="prompt-item">
<div onclick="event.stopPropagation()"><input type="checkbox" class="prompt-checkbox" data-prompt-id="${p.id}"></div>
<div class="prompt-info" onclick="loadPromptFromLibrary('${p.id}')">
<div style="display:flex;align-items:center;gap:8px;">
<span onclick="event.stopPropagation();toggleFavorite('${p.id}')" style="cursor:pointer;font-size:18px;user-select:none;color:#f59e0b;">
${p.favorite?'â˜…':'â˜†'}
</span>
<div style="flex:1;">
<div class="prompt-title">${p.title}</div>
<div class="prompt-date">${p.created}</div>
</div>
</div>
</div>
</div>
`).join('');
}

function loadPromptFromLibrary(id){
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
const prompt=savedPrompts.find(p=>p.id==id);
if(!prompt){alert('Not found.');return;}
document.getElementById('promptDisplay').innerHTML=`<pre style="white-space:pre-wrap;font-family:inherit;margin:0">${prompt.content}</pre>`;
}

function deleteSelectedPrompts(){
const checkboxes=document.querySelectorAll('.prompt-checkbox:checked');
const selectedIds=Array.from(checkboxes).map(cb=>cb.dataset.promptId);
if(selectedIds.length===0)return;
const savedPrompts=JSON.parse(localStorage.getItem('thinkprompt_ministry_saved')||'[]');
const remaining=savedPrompts.filter(p=>!selectedIds.includes(p.id.toString()));
localStorage.setItem('thinkprompt_ministry_saved',JSON.stringify(remaining));
renderPromptsList();
}

function copyPrompt(){
const text=document.getElementById('promptDisplay').textContent.trim();
if(text){
navigator.clipboard.writeText(text).then(()=>showCopySuccess('Copied!'));
}else{alert('No prompt to copy.');}
}

function editPrompt(){
document.getElementById('promptDisplay').focus();
alert('You can now edit the prompt.');
}

function exportPrompt(){
const text=document.getElementById('promptDisplay').textContent;
if(text&&text.trim()){
document.getElementById('exportFilename').value='thinkprompt-ministry-'+new Date().toISOString().split('T')[0];
document.getElementById('exportModalOverlay').style.display='flex';
document.getElementById('exportFilename').focus();
}else{alert('No prompt to export.');}
}

function closeExportModal(){
document.getElementById('exportModalOverlay').style.display='none';
document.getElementById('exportFilename').value='';
}

function confirmExport(){
const filename=document.getElementById('exportFilename').value.trim();
if(!filename){alert('Please enter a filename.');return;}
const text=document.getElementById('promptDisplay').textContent.trim();
const blob=new Blob([text],{type:'text/plain'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=`${filename}.txt`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
closeExportModal();
showCopySuccess('Exported!');
}

function switchStarter(filter){
showLibrary(filter);
document.querySelectorAll('.starter-tab').forEach(t=>t.classList.remove('active'));
document.querySelector(`[data-category="${filter}"]`).classList.add('active');
}

document.addEventListener('DOMContentLoaded',()=>{
initializeFavorites();
loadSystemPrompts();
document.querySelectorAll('.starter-tab').forEach(tab=>{
tab.addEventListener('click',()=>switchStarter(tab.dataset.category));
});
document.getElementById('librarySearch').addEventListener('input',e=>renderPromptsList(e.target.value));
document.getElementById('deleteSelected').addEventListener('click',deleteSelectedPrompts);
document.querySelectorAll('.starter-tab').forEach(t=>t.classList.remove('active'));
});
</script>
</body>
</html>